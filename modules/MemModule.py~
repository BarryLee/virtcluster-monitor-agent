import os
import sys
from mon_module import MonModule
from mon_common import *

metric_list = [
    'mem_total',
    'cached',
    'mem_free',
    'mem_available',
    'mem_used',
    'buffers',
    'swap_total',
    'swap_cached',
    'swap_free'
]

class MemModule(MonModule):

    proc_file_list = [{
        'name'  :   'meminfo',
        'path'  :   '/proc/meminfo'
    }]

    def update(self):
        for item in self.proc_file_list:
            self.update_file(item['name'], item['path'])
        
        self.set_val('meminfo', dict(self.get_val('meminfo')))
        #self.set_val(['meminfo', 'MemUsed'], \
                     #str(int(self.get_val(['meminfo', 'MemTotal']).split()[0]) - \
                     #int(self.get_val(['meminfo', 'MemFree']).split()[0]) - \
                     #int(self.get_val(['meminfo', 'Buffers']).split()[0]) - \
                     #int(self.get_val(['meminfo', 'Cached']).split()[0])))

    def get_mem_total(self):
        return int(self.get_val('meminfo')['MemTotal'].split()[0])

    def get_cached(self):
        return int(self.get_val(['meminfo', 'Cached']).split()[0])

    def get_mem_free(self):
        return int(self.get_val(['meminfo', 'MemFree']).split()[0])

    def get_mem_available(self):
        return int(self.get_val(['meminfo', 'MemFree']).split()[0]) + \
             int(self.get_val(['meminfo', 'Buffers']).split()[0]) + \
             int(self.get_val(['meminfo', 'Cached']).split()[0])

    def get_buffers(self):
        return int(self.get_val(['meminfo', 'Buffers']).split()[0])

    def get_mem_used(self):
        return int(self.get_val(['meminfo', 'MemTotal']).split()[0]) - \
             int(self.get_val(['meminfo', 'MemFree']).split()[0]) - \
             int(self.get_val(['meminfo', 'Buffers']).split()[0]) - \
             int(self.get_val(['meminfo', 'Cached']).split()[0])

    def get_swap_total(self):
        return int(self.get_val(['meminfo', 'SwapTotal']).split()[0])

    def get_swap_cached(self):
        return int(self.get_val(['meminfo', 'SwapCached']).split()[0])

    def get_swap_free(self):
        return int(self.get_val(['meminfo', 'SwapFree']).split()[0])
        
